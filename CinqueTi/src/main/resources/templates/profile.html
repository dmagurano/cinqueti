<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Profilo</title>
    
	<th:block th:include="fragments/common :: commonHeadFragment"></th:block>
</head>
<body>
    <div th:replace="fragments/navbar"></div>

    <div class="container">
		<div id="form"  th:object="${user}" th:fragment="profile">
		    
		    <h3 th:text="'Ciao ' + ${user.nickname} + ', questo è il tuo profilo.'"></h3>
		    
		    <div class="col-lg-3 col-md-2">
				<th:block th:if="${alreadyInUseNickname}">   
			        <div th:replace="fragments/alert :: alert (type='danger', message='Usi gi&agrave; questo nickname.')">
			        	Usi gi&agrave; questo nickname.
			        </div>
		        </th:block>
	
				<th:block th:if="${emptyNickname}">   
			        <div th:replace="fragments/alert :: alert (type='danger', message='Nickname inserito vuoto.')">
			        	Nickname inserito vuoto.
			        </div>
		        </th:block>
	
				<th:block th:if="${updatedNickname}">   
			        <div th:replace="fragments/alert :: alert (type='success', message='Nickname cambiato.')">
			        	Nickname aggiornato.
			        </div>
		        </th:block>

		        <th:block th:if="${mismatchPassword}">   
			        <div th:replace="fragments/alert :: alert (type='danger', message='Le password non coincidono.')">
			        	Le password non coincidono.
			        </div>
		        </th:block>

		        <th:block th:if="${emptyPassword}">   
			        <div th:replace="fragments/alert :: alert (type='danger', message='Le password non possono essere vuote.')">
			        	Le password non possono essere vuote.
			        </div>
		        </th:block>
		        
				<th:block th:if="${wrongOldPassword}">   
			        <div th:replace="fragments/alert :: alert (type='danger', message='Password attuale errata.')">
			        	Password attuale errata.
			        </div>
		        </th:block>
		        
				<th:block th:if="${shortPassword}">   
			        <div th:replace="fragments/alert :: alert (type='danger', message='Password troppo corta.')">
			        	Password troppo corta.
			        </div>
		        </th:block>
		        
				<th:block th:if="${samePassword}">   
			        <div th:replace="fragments/alert :: alert (type='danger', message='La nuova password deve essere diversa da quella attuale.')">
			        	La nuova password deve essere diversa da quella attuale.
			        </div>
		        </th:block>
		        
				<th:block th:if="${updatedPassword}">   
			        <div th:replace="fragments/alert :: alert (type='success', message='Password cambiata.')">
			        	Password cambiata.
			        </div>
		        </th:block>

			    <div class="thumbnail">
					<img th:if="${user.getImage() != null}" 
						th:src="@{'data:image/*;base64,'+${user.generateBase64Image()}}" alt="..."/>
					<img th:if="${user.getImage() == null}" 
						src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQlQiU1yEonftm27j6_3hYC69EMvxwuFQrTJ1cgIFJMwF4tyCnG" alt="..."/>
				</div>

				<hr></hr>

				<button type="button" class="btn btn-default btn-block" data-toggle="modal" data-target="#change-password-modal">Cambia Password</button>

				<hr></hr>

				<button type="button" class="btn btn-default btn-block" data-toggle="modal" data-target="#change-nickname-modal">Cambia Nickname</button>

		    </div>
		    
			<div class="col-lg-9 col-md-10">
				<table class="table table-user-information">
			    	<tbody>
			    		<tr>
			    			<td>Email</td>
			    			<td th:text="${user.email}"></td>
			    		</tr>
			    		<tr>
			    			<td>Nickname</td>
			    			<td th:text="${user.nickname}"></td>
			    		</tr>
			    		<tr>
			    			<td>Sesso</td>
			    			<td th:text="${user.gender}"></td>
			    		</tr>
			    		<tr>
			    			<td>Età</td>
			    			<td th:text="${user.age}"></td>
			    		</tr>
			    		<tr>
			    			<td>Livello Istruzione</td>
			    			<td th:text="${user.education}"></td>
			    		</tr>
			    		<tr>
			    			<td>Ambito lavorativo</td>
			    			<td th:text="${user.job}"></td>
			    		</tr>
			    		<tr th:if="${user.ownCar.registrationYear} != null">
			    			<td>Auto</td>
			    			<td th:text="'Anno di registrazione: ' + ${user.ownCar.registrationYear}"></td>
			    		</tr>
			    		<tr>
			    			<td></td>
			    			<td th:text="'Carburante: ' + ${user.ownCar.fuelType}"></td>
			    		</tr>
			    		<tr>
			    			<td>Servizio di car sharing</td>
			    			<td th:text="${user.carSharing}">Non usato</td>
			    		</tr>
			    		<tr>
			    			<td>Bici</td>
			    			<td th:if="${user.bikeUsage.owned} == true" th:text="Posseduta"></td>
			    			<td th:if="${user.bikeUsage.owned} == false" th:text="Non posseduta"></td>
			    		</tr>
			    		<tr>
			    			<td></td>
			    			<td th:if="${user.bikeUsage.sharing} == true" th:text="'Servizio bike sharing usato'"></td>
			    			<td th:if="${user.bikeUsage.sharing} == false" th:text="'Servizio bike sharing non usato'"></td>
			    		</tr>
			    		<tr>
			    			<td>Trasporto pubblico</td>
			    			<td th:text="${user.pubTransport}"></td>
			    		</tr>
			    	</tbody>
			    </table>
			</div>
		</div>
	</div>
	
	<div th:replace="fragments/footer"></div>
	
	<!-- change password modal -->
	<div id="change-password-modal" class="modal fade" role="dialog">
	  <div class="modal-dialog">

	    <!-- Modal content-->
	    <div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal">&times;</button>
				<h4 class="modal-title">Cambia password</h4>
			</div>
			<div class="modal-body">

				<form role="form" method="POST" th:action="@{/change-password}">
					<div class="form-group">
						<input type="password" class="form-control" placeholder="Password attuale" name="old-password" autofocus="true" required="true"/>
                
	            		<input type="password" class="form-control" placeholder="Nuova password" name="new-password" required="true"/>
	            
	            	    <input type="password" class="form-control" placeholder="Ripeti nuova password" name="new-password-confirmed" required="true"/>
					</div>

					<button type="button" class="btn btn-default" data-dismiss="modal">Annulla</button>
					<button type="submit" class="btn btn-primary">Conferma</button>
				</form>

			</div>
	    </div>

	  </div>
	</div>
	
	<!-- change nickname modal -->
	<div id="change-nickname-modal" class="modal fade" role="dialog">
	  <div class="modal-dialog">

	    <!-- Modal content-->
	    <div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal">&times;</button>
				<h4 class="modal-title">Cambia nickname</h4>
			</div>
			<div class="modal-body">

				<form role="form" method="POST" th:action="@{/change-nickname}">
					<div class="form-group">
						<input type="text" class="form-control" placeholder="Nuovo nickname" name="new-nickname" autofocus="true" required="required"/>
					</div>

					<div class="btn-group btn-group-justified" role="group" aria-label="...">
  						<div class="btn-group" role="group">
							<button type="button" class="btn btn-default" data-dismiss="modal">Annulla</button>
						</div>
						<div class="btn-group" role="group">
							<button type="submit" class="btn btn-primary">Conferma</button>
						</div>
					</div>
				</form>

			</div>
	    </div>

	  </div>
	</div>
	
	<script type="text/javascript">

	</script>
	
	<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
	<script src="https://code.jquery.com/jquery.js"></script>
	<!-- Include all compiled plugins (below), or include individual files as needed -->
	<script th:src="@{/js/bootstrap.min.js}"></script>
</body>
</html>